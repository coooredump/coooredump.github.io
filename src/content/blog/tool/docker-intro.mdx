---
title: æ·±å…¥æµ…å‡º Docker æŠ€æœ¯
description: Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æˆ– Windows æ“ä½œç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚
publishDate: 2025-04-12
tags: [tool]
heroImage: { src: '../_img/202311141756070.jpg' }
language: Chinese
comment: true
draft: false
---

## Docker æ˜¯ä»€ä¹ˆ

Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æˆ– Windows æ“ä½œç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚

![E506BFAF-560F-4AA3-95C6-98C604EC69B2_1_201_a.jpeg](http://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fec2e706f9dc4206b2ffe7024fd24a69~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

### å®¹å™¨æŠ€æœ¯

å®¹å™¨ä½¿è½¯ä»¶åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿè„±é’©ï¼Œä»è€Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå¹²å‡€è€Œæœ€å°çš„Linuxç¯å¢ƒï¼ŒåŒæ—¶åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªéš”ç¦»çš„â€œå®¹å™¨â€ä¸­è¿è¡Œå…¶ä»–æ‰€æœ‰å†…å®¹ã€‚å®¹å™¨çš„ç›®çš„æ˜¯å¯åŠ¨ä¸€ç»„æœ‰é™çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼ˆé€šå¸¸ç§°ä¸ºå¾®æœåŠ¡ï¼‰ï¼Œå¹¶ä½¿å®ƒä»¬åœ¨ç‹¬ç«‹çš„æ²™ç›’ç¯å¢ƒä¸­è¿è¡Œã€‚

è¿™ç§éš”ç¦»å¯é˜²æ­¢åœ¨ç»™å®šå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ç›‘è§†æˆ–å½±å“åœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚åŒæ ·ï¼Œè¿™äº›å®¹å™¨åŒ–æœåŠ¡ä¸ä¼šå½±å“æˆ–å¹²æ‰°ä¸»æœºã€‚èƒ½å¤Ÿå°†åˆ†æ•£åœ¨å¤šä¸ªç‰©ç†æœåŠ¡å™¨ä¸Šçš„è®¸å¤šæœåŠ¡æ•´åˆä¸ºä¸€ä¸ªçš„æƒ³æ³•ï¼Œæ˜¯æ•°æ®ä¸­å¿ƒé€‰æ‹©é‡‡ç”¨è¯¥æŠ€æœ¯çš„ä¼—å¤šåŸå› ä¹‹ä¸€ã€‚

### å®¹å™¨VSè™šæ‹Ÿæœº

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹é¢ä¸€å¼ å›¾ï¼Œä¸‹é¢æ˜¯è™šæ‹Ÿæœºçš„å®ç°æ–¹å¼

![1630839530493_61cb27a5d0f2149a41488d8c9f932bf0.png](http://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ff0caabe0254cfeb1e92a2eeb03eb53~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

è™šæ‹Ÿæœºå®ç°èµ„æºéš”ç¦»çš„æ–¹æ³•æ˜¯åˆ©ç”¨åœ¨ä¸»æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œç‹¬ç«‹çš„ä»æ“ä½œç³»ç»Ÿï¼Œä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨æœ€åº•å±‚è¿è¡Œçš„æ˜¯æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„æœåŠ¡å™¨ï¼Œé€šå¸¸æœåŠ¡å™¨ä¸Šä¼šè¿è¡Œä¸€ä¸ªä¸»æ“ä½œç³»ç»Ÿ.

è™šæ‹Ÿæœºçš„Guest OSå³ä¸ºè™šæ‹Ÿæœºå®‰è£…çš„æ“ä½œç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿå†…æ ¸ï¼›è™šæ‹Ÿæœºçš„Hypervisorå±‚å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªç¡¬ä»¶è™šæ‹ŸåŒ–å¹³å°ï¼Œä»–è´Ÿè´£åè°ƒå®¿ä¸»æœºä¸Šçš„ç¡¬ä»¶èµ„æºåˆ†é…ä¸ç®¡ç†.ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„è™šæ‹Ÿæœºè½¯ä»¶å°±æ˜¯Parallels Desktop.

ä¸‹é¢å†æ¥çœ‹çœ‹Dockerçš„å®ç°æ–¹å¼

![1630839542476_a5f81adc1406b44da7941fa87b179b61.png](http://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4f72eaa2add4217b442c3ea653a442c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

Dockerå®¹å™¨æŠ€æœ¯çš„å®ç°è¦æ¯”è™šæ‹ŸæœºæŠ€æœ¯çš„å®ç°å‡å°‘ä¸€å±‚ï¼Œç”±äºDockerä¸éœ€è¦Hypervisorå®ç°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–ï¼Œ**è¿è¡Œåœ¨Dockerå®¹å™¨ä¸Šçš„ç¨‹åºç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯å®é™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æº**ã€‚å› æ­¤åœ¨CPUã€å†…å­˜åˆ©ç”¨ç‡ä¸ŠDockerå°†ä¼šåœ¨æ•ˆç‡ä¸Šæœ‰ä¼˜åŠ¿.

æœ€ååšä¸€ä¸ªç®€å•çš„æ¯”è¾ƒ.

| ç‰¹æ€§ | å®¹å™¨ | è™šæ‹Ÿæœº |
| --- | --- | --- |
| å¯åŠ¨ | ç§’çº§ | åˆ†é’Ÿçº§ |
| ç¡¬ç›˜ä½¿ç”¨ | ä¸€èˆ¬ä¸ºMB | ä¸€èˆ¬ä¸ºGB |
| æ€§èƒ½ | æ¥è¿‘åŸç”Ÿ | å¼±äº |
| ç³»ç»Ÿæ”¯æŒé‡ | å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ | ä¸€èˆ¬æ˜¯å‡ åä¸ª |

## Docker çš„ä½¿ç”¨

å¯èƒ½æœ‰éƒ¨åˆ†è¯»è€…æœ‹å‹ä»¬æ²¡æœ‰ç›´æ¥çš„ä½¿ç”¨è¿‡docker.æˆ‘ä»¬å…ˆæ¥ä¸¾ä¸€ä¸ªä¾‹å­.åœ¨ä»¥å‰æ²¡æœ‰dockerçš„æƒ…å†µä¸‹ï¼Œå‡ä½¿æˆ‘ä»¬æƒ³åœ¨linuxç¯å¢ƒä¸‹è¿è¡Œä¸€ä¸ªmysqlï¼Œå¯èƒ½æˆ‘ä»¬å…ˆè¦ä¸‹è½½å‹ç¼©åŒ…ï¼Œè§£å‹ï¼Œç¼–è¯‘ï¼Œè®¾ç½®ç­‰ç­‰æµç¨‹ï¼Œååˆ†å¤æ‚.

ä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨dockerè¿è¡Œmysqlæ—¶ï¼Œåªéœ€è¦å…ˆè¿è¡Œ`docker pull mysql`å°±ä¼šè‡ªåŠ¨ä¸‹è½½æœ€æ–°çš„mysqlé•œåƒ.

å†è¿è¡Œ`docker run mysql`ä»¥åï¼Œå°±å¯ä»¥ç›´æ¥è¿è¡Œï¼Œå¦‚æœä½ æƒ³å†è¿è¡Œä¸€ä»½mysqlå®ä¾‹ï¼Œåªéœ€è¦å†è¿è¡Œä¸€æ¬¡`docker run`çš„å‘½ä»¤ï¼Œå¹¶è®¾ç½®æ–°çš„ç«¯å£å°±èƒ½è¿è¡Œï¼Œè¿™ä¹ˆä¸€çœ‹æ˜¯ä¸æ˜¯æ„Ÿè§‰dockeræ˜¯ä¸æ˜¯éå¸¸å¥½ç”¨.

dockerçš„åŠŸèƒ½è¿˜è¿œè¿œä¸æ­¢è¿™äº›ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€èµ·èµ°è¿›dockerï¼Œçœ‹çœ‹dockeræ˜¯æ€ä¹ˆå®ç°çš„å®¹å™¨æŠ€æœ¯.

## Docker åŸºç¡€æ¦‚å¿µ

### è¿è¡Œæµç¨‹

![æµç¨‹.jpeg](http://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc2fac06427d4799b40017fb410e0de2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

åœ¨Dockerè¿è¡Œçš„æµç¨‹å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠimageç†è§£ä¸ºå¯æ‰§è¡Œç¨‹åºï¼ŒContainerå°±æ˜¯è¿è¡Œèµ·æ¥çš„è¿›ç¨‹ã€‚Registryå°±æ˜¯ä»£ç ç®¡ç†å¹³å°.

é‚£ä¹ˆå†™ç¨‹åºéœ€è¦æºä»£ç ï¼Œé‚£ä¹ˆâ€œå†™â€imageçš„"æºä»£ç "å°±æ˜¯dockerfileï¼Œdockerå°±æ˜¯"ç¼–è¯‘å™¨"ã€‚

å› æ­¤æˆ‘ä»¬åªéœ€è¦åœ¨dockerfileä¸­æŒ‡å®šéœ€è¦å“ªäº›ç¨‹åºã€ä¾èµ–ä»€ä¹ˆæ ·çš„é…ç½®ï¼Œä¹‹åæŠŠdockerfileäº¤ç»™â€œç¼–è¯‘å™¨â€dockerè¿›è¡Œâ€œç¼–è¯‘â€ï¼Œç”Ÿæˆ"å¯æ‰§è¡Œç¨‹åº"imageï¼Œä¹‹åå°±å¯ä»¥è¿è¡Œè¿™ä¸ªimageäº†ï¼Œimageè¿è¡Œèµ·æ¥åå°±æ˜¯`Docker container`ã€‚

### `Image`(é•œåƒ)

**Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚** é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚

é¦–å…ˆæ¥çœ‹ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¾‹å­:

![1625490629341_9e19801dc41a18fb83bf93c00a5db13f.png](http://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b23cc443a5842b8b87ce4ad8cd7c958~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ä¸Šå›¾æ˜¯ä¸€ä¸ªç”±debianç³»ç»Ÿä½œä¸ºåŸºç¡€é•œåƒçš„ç®€å†æ ·ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸­é—´å±‚å°±æ˜¯åŸºç¡€çš„é•œåƒï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹é•œåƒè¿›è¡Œä»»ä½•å®šåˆ¶åŒ–çš„æ“ä½œï¼Œè¿è¡Œèµ·æ¥åå°±ç”Ÿæˆäº†ä¸€ä¸ªå®¹å™¨ï¼Œå®¹å™¨æ‰æ˜¯å¯å†™çš„å¯¹è±¡.

å¯¹äºLinuxè€Œè¨€ï¼Œå†…æ ¸å¯åŠ¨åï¼Œä¼šæŒ‚è½½rootæ–‡ä»¶ç³»ç»Ÿä¸ºå…¶æä¾›ç”¨æˆ·ç©ºé—´æ”¯æŒã€‚è€ŒDockeré•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªrootæ–‡ä»¶ç³»ç»Ÿã€‚

å½“ç„¶ï¼ŒDockerèƒ½å®ç°çš„åŠŸèƒ½è¿œä¸æ­¢å¦‚æ­¤ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨DockerFileæ„å»ºä¸€ä¸ªå®šåˆ¶åŒ–é•œåƒ:

```
FROM debian
RUN apt-get install emacs
RUN apt-get install apache2
CMD ["/bin/bash"]
```

![1625490629343_a52602982fa713b466af861a0644f458.png](http://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5706b485db3640a4a34fde506411dece~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

Dockerè®¾è®¡æ—¶ï¼Œå……åˆ†åˆ©ç”¨**Union FS**çš„æŠ€æœ¯ï¼Œå°†å…¶è®¾è®¡ä¸º**åˆ†å±‚å­˜å‚¨çš„æ¶æ„**ã€‚é•œåƒå®é™…æ˜¯ç”±å¤šå±‚æ–‡ä»¶ç³»ç»Ÿè”åˆç»„æˆã€‚

**é•œåƒæ„å»ºæ—¶ï¼Œä¼šä¸€å±‚å±‚æ„å»ºï¼Œå‰ä¸€å±‚æ˜¯åä¸€å±‚çš„åŸºç¡€ã€‚æ¯ä¸€å±‚æ„å»ºå®Œå°±ä¸ä¼šå†å‘ç”Ÿæ”¹å˜ï¼Œåä¸€å±‚ä¸Šçš„ä»»ä½•æ”¹å˜åªå‘ç”Ÿåœ¨è‡ªå·±è¿™ä¸€å±‚ã€‚**

åˆ†å±‚å­˜å‚¨çš„ç‰¹å¾è¿˜ä½¿å¾—é•œåƒçš„å¤ç”¨ã€å®šåˆ¶å˜çš„æ›´ä¸ºå®¹æ˜“ã€‚ç”šè‡³å¯ä»¥ç”¨ä¹‹å‰æ„å»ºå¥½çš„é•œåƒä½œä¸ºåŸºç¡€å±‚ï¼Œç„¶åè¿›ä¸€æ­¥æ·»åŠ æ–°çš„å±‚ï¼Œä»¥å®šåˆ¶è‡ªå·±æ‰€éœ€çš„å†…å®¹ï¼Œæ„å»ºæ–°çš„é•œåƒã€‚

ä½†æ˜¯åœ¨æ„å»ºé•œåƒæ—¶ä¹Ÿè¦æ ¼å¤–çš„æ³¨æ„ï¼Œæ¯”å¦‚ï¼Œåˆ é™¤å‰ä¸€å±‚æ–‡ä»¶çš„æ“ä½œï¼Œå®é™…ä¸æ˜¯çœŸçš„åˆ é™¤å‰ä¸€å±‚çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä»…åœ¨å½“å‰å±‚æ ‡è®°ä¸ºè¯¥æ–‡ä»¶å·²åˆ é™¤ã€‚åœ¨æœ€ç»ˆå®¹å™¨è¿è¡Œçš„æ—¶å€™ï¼Œè™½ç„¶ä¸ä¼šçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å®é™…ä¸Šè¯¥æ–‡ä»¶ä¼šä¸€ç›´è·Ÿéšé•œåƒã€‚æ‰€ä»¥åœ¨æ„å»ºé•œåƒæ—¶ï¼Œæ¯ä¸€å±‚å°½é‡åªåŒ…å«è¯¥å±‚éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•é¢å¤–çš„ä¸œè¥¿åº”è¯¥åœ¨è¯¥å±‚æ„å»ºç»“æŸå‰æ¸…ç†æ‰ã€‚

### `Container`(å®¹å™¨)

å®¹å™¨Â `(container)`Â çš„å®šä¹‰å’Œé•œåƒÂ `(image)`Â å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€åŒºåˆ«åœ¨äºå®¹å™¨çš„æœ€ä¸Šé¢é‚£ä¸€å±‚æ˜¯å¯è¯»å¯å†™çš„ã€‚

å¹¿ä¹‰ä¸Šæˆ‘ä»¬å¯ä»¥å°†å®¹å™¨ç†è§£ä¸ºï¼Œå®¹å™¨ = é•œåƒ + è¯»å†™å±‚ã€‚

### `Repository`(ä»“åº“)

é•œåƒæ„å»ºå®Œæˆåï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨å½“å‰å®¿ä¸»ä¸Šè¿è¡Œï¼Œä½†æ˜¯å¦‚ä½•åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œè¿™ä¸ªé•œåƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªé›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€.è¿™æ—¶å°±å¼•å‡ºäº†`Docker Repository`çš„æ¦‚å¿µ.

`Docker Registry`Â (ä»“åº“æ³¨å†ŒæœåŠ¡å™¨)æ˜¯ä¸€ä¸ªé›†ä¸­çš„å­˜å‚¨ã€åˆ†å‘é•œåƒçš„æœåŠ¡ã€‚`Docker`Â ä»“åº“çš„æ¦‚å¿µè·ŸÂ `Git`Â ç±»ä¼¼ï¼Œæ³¨å†ŒæœåŠ¡å™¨å¯ä»¥ç†è§£ä¸ºÂ `GitHub`Â è¿™æ ·çš„æ‰˜ç®¡æœåŠ¡ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªÂ `Docker Registry`Â ä¸­å¯ä»¥åŒ…å«å¤šä¸ªä»“åº“Â `(Repository)`Â ï¼Œæ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ªæ ‡ç­¾Â `(Tag)`ï¼Œæ¯ä¸ªæ ‡ç­¾å¯¹åº”ç€ä¸€ä¸ªé•œåƒã€‚æ‰€ä»¥è¯´ï¼Œé•œåƒä»“åº“æ˜¯Â `Docker`Â ç”¨æ¥é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœ°æ–¹ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰å¸¸ç”¨çš„ä»£ç ä»“åº“ã€‚

é€šå¸¸ï¼Œ**ä¸€ä¸ªä»“åº“ä¼šåŒ…å«åŒä¸€ä¸ªè½¯ä»¶ä¸åŒç‰ˆæœ¬çš„é•œåƒ**ï¼Œè€Œ**æ ‡ç­¾å°±å¸¸ç”¨äºå¯¹åº”è¯¥è½¯ä»¶çš„å„ä¸ªç‰ˆæœ¬**Â ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`<ä»“åº“å>:<æ ‡ç­¾>`çš„æ ¼å¼æ¥æŒ‡å®šå…·ä½“æ˜¯è¿™ä¸ªè½¯ä»¶å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœä¸ç»™å‡ºæ ‡ç­¾ï¼Œå°†ä»¥Â `latest`Â ä½œä¸ºé»˜è®¤æ ‡ç­¾.ã€‚

ä»“åº“åˆå¯ä»¥åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼š

-   `public`(å…¬æœ‰ä»“åº“)
-   `private`(ç§æœ‰ä»“åº“)

`Docker Registry`Â å…¬æœ‰ä»“åº“æ˜¯å¼€æ”¾ç»™ç”¨æˆ·ä½¿ç”¨ã€å…è®¸ç”¨æˆ·ç®¡ç†é•œåƒçš„Â `Registry`Â æœåŠ¡ã€‚ä¸€èˆ¬è¿™ç±»å…¬å¼€æœåŠ¡å…è®¸ç”¨æˆ·å…è´¹ä¸Šä¼ ã€ä¸‹è½½å…¬å¼€çš„é•œåƒï¼Œå¹¶å¯èƒ½æä¾›æ”¶è´¹æœåŠ¡ä¾›ç”¨æˆ·ç®¡ç†ç§æœ‰é•œåƒã€‚

é™¤äº†ä½¿ç”¨å…¬å¼€æœåŠ¡å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åœ¨æœ¬åœ°æ­å»ºç§æœ‰Â `Docker Registry`Â ã€‚`Docker`Â å®˜æ–¹æä¾›äº†Â `Docker Registry`é•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åšä¸ºç§æœ‰Â `Registry`Â æœåŠ¡ã€‚å½“ç”¨æˆ·åˆ›å»ºäº†è‡ªå·±çš„é•œåƒä¹‹åå°±å¯ä»¥ä½¿ç”¨Â `push`Â å‘½ä»¤å°†å®ƒä¸Šä¼ åˆ°å…¬æœ‰æˆ–è€…ç§æœ‰ä»“åº“ï¼Œè¿™æ ·ä¸‹æ¬¡åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šä½¿ç”¨è¿™ä¸ªé•œåƒæ—¶å€™ï¼Œåªéœ€è¦ä»ä»“åº“ä¸ŠÂ `pull`Â ä¸‹æ¥å°±å¯ä»¥äº†ã€‚

## Docker æ¶æ„

![æµç¨‹å›¾.jpeg](http://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7613ee72cd344c279cd80819eb274283~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

Dockeræ˜¯ä¸€ä¸ªC/Sæ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œæ¨¡å—å„å¸å…¶èŒã€‚

1.  ç”¨æˆ·çš„æ‰€æœ‰å‘½ä»¤é€šè¿‡`Docker Client`ä¸`Docker Daemon`å»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚
2.  `Docker Daemon`ä½œä¸ºDockeræ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾›Serverçš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥å—`Docker Client`çš„è¯·æ±‚ï¼›
3.  Engineæ‰§è¡ŒDockerå†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ªJobçš„å½¢å¼çš„å­˜åœ¨ã€‚

åœ¨ä¹‹å‰çš„åŸºç¡€æ¦‚å¿µä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†Registryï¼ŒContainerç­‰æ¦‚å¿µ.æ¥ä¸‹æ¥å°±æ˜¯ä¸€äº›Dockerè¿è¡Œè¿‡ç¨‹ä¸­çš„ç»„ä»¶ä»‹ç».

### `Docker Client`

1.  `Docker Client`æ˜¯å’Œ`Docker Daemon`å»ºç«‹é€šä¿¡çš„å®¢æˆ·ç«¯ã€‚ç”¨æˆ·ä½¿ç”¨dockerå‘½ä»¤åï¼Œ`Docker Client`è´Ÿè´£è§£æå¯¹åº”çš„å‘½ä»¤ä»¥åŠå‚æ•°ï¼Œå¹¶å‘`Docker Daemon`æœåŠ¡ç«¯å‘èµ·è¯·æ±‚.
2.  `Docker Client`å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼å’Œ`Docker Daemon`å»ºç«‹é€šä¿¡ï¼š
    1.  `tcp://host:port`
    2.  `unix://path_to_socket`
    3.  `fd://socketfd`
3.  `Docker Client`å‘é€å®¹å™¨ç®¡ç†è¯·æ±‚åï¼Œç”±`Docker Daemon`æ¥å—å¹¶å¤„ç†è¯·æ±‚ï¼Œå½“`Docker Client`æ¥æ”¶åˆ°è¿”å›çš„è¯·æ±‚ç›¸åº”å¹¶ç®€å•å¤„ç†åï¼Œ`Docker Client`ä¸€æ¬¡å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ã€‚ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚ï¼šå‘é€è¯·æ±‚â†’å¤„ç†è¯·æ±‚â†’è¿”å›ç»“æœï¼Œä¸ä¼ ç»Ÿçš„C/Sæ¶æ„è¯·æ±‚æµç¨‹ä¸€è‡´.

### `Docker Daemon`

![image.png](http://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/068f78bad06f4007a4b469f20ef22840~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

Docker Daemonæ˜¯dockerçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œä¹Ÿæ˜¯dockerè¿è¡Œæ—¶çš„æ ¸å¿ƒ.åˆ†åˆ«æœ‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ.

1.  Docker Server
    1.  `Docker Server`ç›¸å½“äºC/Sæ¶æ„çš„æœåŠ¡ç«¯ã€‚åŠŸèƒ½ä¸ºæ¥å—å¹¶è°ƒåº¦åˆ†å‘Docker Clientå‘é€çš„è¯·æ±‚ã€‚æ¥å—è¯·æ±‚åï¼ŒServeré€šè¿‡è·¯ç”±ä¸åˆ†å‘è°ƒåº¦ï¼Œæ‰¾åˆ°ç›¸åº”çš„Handleræ¥æ‰§è¡Œè¯·æ±‚ã€‚
    2.  åœ¨Serverçš„æœåŠ¡è¿‡ç¨‹ä¸­ï¼ŒServeråœ¨listenerä¸Šæ¥å—`Docker Client`çš„è®¿é—®è¯·æ±‚ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„goroutineæ¥æœåŠ¡è¯¥è¯·æ±‚ã€‚åœ¨goroutineä¸­ï¼Œé¦–å…ˆè¯»å–è¯·æ±‚å†…å®¹ï¼Œç„¶ååšè§£æå·¥ä½œï¼Œæ¥ç€æ‰¾åˆ°ç›¸åº”çš„è·¯ç”±é¡¹ï¼Œéšåè°ƒç”¨ç›¸åº”çš„Handleræ¥å¤„ç†è¯¥è¯·æ±‚ï¼Œæœ€åHandlerå¤„ç†å®Œè¯·æ±‚ä¹‹åå›å¤è¯¥è¯·æ±‚ã€‚
2.  Engine
    1.  `Engine`æ˜¯Dockeræ¶æ„ä¸­çš„è¿è¡Œå¼•æ“ï¼Œé€šè¿‡æ‰§è¡Œ`Job`çš„æ–¹å¼æ¥ç®¡ç†æ‰€æœ‰çš„å®¹å™¨ä¸é•œåƒã€‚
    2.  åœ¨`Engine`æ•°æ®ç»“æ„çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªhandlerå¯¹è±¡ã€‚è¯¥handlerå¯¹è±¡å­˜å‚¨çš„éƒ½æ˜¯å…³äºä¼—å¤šç‰¹å®šjobçš„handlerå¤„ç†è®¿é—®ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œ`Engine`çš„handlerå¯¹è±¡ä¸­æœ‰ä¸€é¡¹ä¸ºï¼š`{â€œcreateâ€: daemon.ContainerCreateï¼Œ}`ï¼Œåˆ™è¯´æ˜å½“åä¸º"create"çš„jobåœ¨è¿è¡Œæ—¶ï¼Œæ‰§è¡Œçš„æ˜¯`daemon.ContainerCreateçš„handler`ã€‚
3.  Job
    1.  ä¸€ä¸ª`Job`å¯ä»¥è®¤ä¸ºæ˜¯Dockeræ¶æ„ä¸­`Engine`å†…éƒ¨æœ€åŸºæœ¬çš„å·¥ä½œæ‰§è¡Œå•å…ƒã€‚Dockerå¯ä»¥åšçš„æ¯ä¸€é¡¹å·¥ä½œï¼Œéƒ½å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ª`Job`ã€‚æ— è®ºæ˜¯é•œåƒçš„ä¸‹è½½ï¼Œå®¹å™¨çš„è¿è¡Œåœæ­¢ç­‰ç­‰ã€‚`Docker Server`çš„è¿è¡Œè¿‡ç¨‹å®é™…ä¹Ÿæ˜¯ä¸€ä¸ª`Job`ï¼Œåä¸º`serveapi`ã€‚
    2.  `Job`çš„æ¦‚å¿µä¸Unixä¸­è¿›ç¨‹ç›¸ä»¿ã€‚åœ¨Unixè¿›ç¨‹ä¸­ï¼Œå¯¹æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰åç§°ï¼Œå‚æ•°ï¼Œç¯å¢ƒå˜é‡ï¼Œæ ‡å‡†çš„è¾“å…¥è¾“å‡ºï¼Œé”™è¯¯å¤„ç†ï¼Œè¿”å›çŠ¶æ€ç­‰ï¼Œåœ¨Dockerçš„`Job`ä¹Ÿéƒ½å­˜åœ¨.

### `Graph`

![image.png](http://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05a4bcafff83445dbe388a191f27f0e5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

Graphä¸­ç®¡ç†ç€æ‰€æœ‰æœ¬åœ°å·²ç»ä¸‹è½½çš„é•œåƒ.å…¶ä¸­Graph DBä¸­è®°å½•äº†æ‰€æœ‰é•œåƒä¹‹é—´çš„ä¾èµ–å…³ç³».

### `Driver`

é€šè¿‡Driveré©±åŠ¨ï¼ŒDockerå¯ä»¥å®ç°å¯¹Dockerå®¹å™¨è¿è¡Œç¯å¢ƒçš„å®šåˆ¶ï¼Œå®šåˆ¶çš„ç»´åº¦ä¸»è¦æœ‰ç½‘ç»œç¯å¢ƒã€å­˜å‚¨æ–¹å¼ä»¥åŠå®¹å™¨æ‰§è¡Œæ–¹å¼ã€‚

![image.png](http://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06f87e1cb82e4abda4d59fc8d772b549~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

Docker Driverçš„å®ç°å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»é©±åŠ¨ï¼šgraphdriverã€networkdriverå’Œexecdriverã€‚

#### `graphdriver`

> graphdriverä¸»è¦ç”¨äºå®Œæˆå®¹å™¨é•œåƒçš„ç®¡ç†ï¼ŒåŒ…æ‹¬å­˜å‚¨ä¸è·å–ã€‚ 

![image.png](http://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eebbca3b2f5a43f3ad447d55d6b32489~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

graphdriverä¸»è¦ç”¨äºå®¹å™¨é•œåƒçš„ç®¡ç†:

1.  è´Ÿè´£ä»Docker Registryä¸‹è½½é•œåƒå¹¶è¿›è¡Œå­˜å‚¨ï¼Œå½“ç”¨æˆ·ä¸‹è½½æŒ‡å®šçš„å®¹å™¨é•œåƒæ—¶ï¼Œgraphdriverå°†å®¹å™¨é•œåƒåˆ†å±‚å­˜å‚¨åœ¨æœ¬åœ°çš„æŒ‡å®šç›®å½•ä¸‹.
2.  è´Ÿè´£ä»æœ¬åœ°é•œåƒå­˜å‚¨ç›®å½•ä¸­è·å–æŒ‡å®šçš„å®¹å™¨é•œåƒï¼Œå¹¶æŒ‰ç‰¹å®šè§„åˆ™ä¸ºå®¹å™¨å‡†å¤‡rootfsï¼›
3.  è´Ÿè´£ç®¡ç†é€šè¿‡æŒ‡å®šDockerfileæ„å»ºçš„å…¨æ–°é•œåƒã€‚

#### `networkdriver`

![image.png](http://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0dc8ecdea7a4b9390287c0354d2f3b7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

networkdriverçš„ä½œç”¨æ˜¯å®ŒæˆDockerå®¹å™¨ç½‘ç»œç¯å¢ƒçš„é…ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬:

1.  Docker Daemonå¯åŠ¨æ—¶ä¸ºDockerç¯å¢ƒåˆ›å»ºç½‘æ¡¥ï¼›
2.  Dockerå®¹å™¨åˆ›å»ºå‰ä¸ºå…¶åˆ†é…ç›¸åº”çš„ç½‘ç»œæ¥å£èµ„æºï¼›
3.  Dockerå®¹å™¨åˆ†é…IPã€ç«¯å£å¹¶ä¸å®¿ä¸»æœºåšNATç«¯å£æ˜ å°„ï¼Œè®¾ç½®å®¹å™¨é˜²ç«å¢™ç­–ç•¥ç­‰

#### `execdriver`

![image.png](http://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9cbd51d2c8d4104b76a7d1778d22fec~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

execdriverä½œä¸ºDockerå®¹å™¨çš„æ‰§è¡Œé©±åŠ¨ï¼Œè´Ÿè´£åˆ›å»ºå®¹å™¨è¿è¡Œæ—¶çš„å‘½åç©ºé—´ï¼Œè´Ÿè´£ç®¡ç†å®¹å™¨èµ„æºä½¿ç”¨çš„ç»Ÿè®¡ä¸é™åˆ¶ï¼Œè´Ÿè´£å®¹å™¨å†…éƒ¨è¿›ç¨‹çš„çœŸæ­£è¿è¡Œç­‰

> åœ¨Docker 0.9.0ç‰ˆæœ¬ä¹‹å‰ï¼Œåªæ”¯æŒä½¿ç”¨Linuxçš„LXCé©±åŠ¨è¿›è¡Œå®¹å™¨ç®¡ç†ï¼Œåœ¨0.9.0ç‰ˆæœ¬ä¹‹åé»˜è®¤ä½¿ç”¨nativeé©±åŠ¨å®ç°ï¼Œnativeé©±åŠ¨æ˜¯dockeré¡¹ç›®ä¸‹ä¸€ä¸ªå…¨æ–°çš„å­é¡¹ç›®ï¼Œå»é™¤äº†å¤–éƒ¨ä¾èµ–.

### `libcontainer`

![image.png](http://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e979e7578dc4e39b0d1f2093be8be49~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ibcontaineræ˜¯Dockeræ¶æ„ä¸­ä¸€ä¸ªä½¿ç”¨Goè¯­è¨€è®¾è®¡å®ç°çš„åº“ï¼Œè®¾è®¡åˆè¡·æ˜¯å¸Œæœ›è¯¥åº“å¯ä»¥ä¸ä¾é ä»»ä½•ä¾èµ–ï¼Œç›´æ¥è®¿é—®å†…æ ¸ä¸­ä¸å®¹å™¨ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ã€‚

æ­£æ˜¯ç”±äºlibcontainerçš„å­˜åœ¨ï¼Œæ‰ä½¿å¾—dockerå¯ä»¥ä¸éœ€è¦ä¾èµ–LXCæˆ–è€…å…¶ä»–åŒ…å°±å¯ä»¥å®Œæˆå¯¹é˜²ç«å¢™ï¼Œnamespacesç­‰çš„æ“ä½œã€‚

### `Docker Container`

Docker Containerï¼ˆDockerå®¹å™¨ï¼‰æ˜¯Dockeræ¶æ„ä¸­æœåŠ¡äº¤ä»˜çš„æœ€ç»ˆä½“ç°å½¢å¼ã€‚Dockeré€šè¿‡DockerDaemonçš„ç®¡ç†ï¼Œlibcontainerçš„æ‰§è¡Œï¼Œæœ€ç»ˆåˆ›å»ºDockerå®¹å™¨ã€‚Dockerå®¹å™¨ä½œä¸ºä¸€ä¸ªäº¤ä»˜å•ä½ï¼ŒåŠŸèƒ½ç±»ä¼¼äºä¼ ç»Ÿæ„ä¹‰ä¸Šçš„è™šæ‹Ÿæœºï¼ˆVirtual Machineï¼‰ï¼Œå…·å¤‡èµ„æºå—é™ã€ç¯å¢ƒä¸å¤–ç•Œéš”ç¦»çš„ç‰¹ç‚¹ã€‚

### æµç¨‹æ¢³ç†

çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ç›¸ä¿¡å„ä½è¯»è€…æœ‹å‹ä»¬åº”è¯¥å·²ç»å¯¹DockeråŸºç¡€æ¶æ„æœ‰äº†ä¸€ä¸ªå¤§æ¦‚å¾—è®¤çŸ¥äº†ï¼Œè®©æˆ‘ä»¬ä»¥docker runä¸ºä¾‹å­å›é¡¾ä¸€ä¸‹Â `Docker`Â å„ä¸ªç»„ä»¶æ˜¯å¦‚ä½•åä½œçš„ã€‚

å‡è®¾æˆ‘ä»¬è¦è¿è¡Œä¸€æ¡: `docker run -p 3306:3306 --name mysql -d mysql`

å®¹å™¨å¯åŠ¨è¿‡ç¨‹å¦‚ä¸‹ï¼š

-   `Docker`Â å®¢æˆ·ç«¯æ‰§è¡ŒÂ `docker run`Â å‘½ä»¤
-   `Docker daemon`Â é€šè¿‡`graghdriver`å»`Gragh`ä¸­æ‹‰å–æœ€æ–°çš„Â `mysql`Â é•œåƒ
-   `Docker daemon`Â é€šè¿‡`networkdriver`å»ºç«‹ç«¯å£æ˜ å°„
-   `Docker daemon`Â é€šè¿‡`execdriver`å¯åŠ¨å®¹å™¨

## Docker æ ¸å¿ƒæŠ€æœ¯å®ç°

åœ¨äº†è§£äº†è¿™ä¹ˆå¤šDockerå®ç°ä»¥åï¼Œæˆ‘ä»¬å¯èƒ½è¿˜ä¼šæœ‰æœ€åä¸€äº›ç–‘é—®ï¼ŒDockeræ˜¯å¦‚ä½•å®ç°èµ„æºéš”ç¦»çš„.

åœ¨æ—¥å¸¸ä½¿ç”¨ Linux æˆ–è€… macOS æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿è¡Œå¤šä¸ªå®Œå…¨åˆ†ç¦»çš„æœåŠ¡å™¨çš„éœ€è¦ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨äº†å¤šä¸ªæœåŠ¡ï¼Œè¿™äº›æœåŠ¡å…¶å®ä¼šç›¸äº’å½±å“çš„ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½èƒ½çœ‹åˆ°å…¶ä»–æœåŠ¡çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥è®¿é—®å®¿ä¸»æœºå™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ï¼Œè¿™æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¸æ„¿æ„çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šçš„ä¸åŒæœåŠ¡èƒ½åšåˆ°**å®Œå…¨éš”ç¦»**ï¼Œå°±åƒè¿è¡Œåœ¨å¤šå°ä¸åŒçš„æœºå™¨ä¸Šä¸€æ ·ã€‚

Dockerå®ç°å®¹å™¨ä¹‹é—´çš„**å®Œå…¨éš”ç¦»**ä¸€å…±ä½¿ç”¨åˆ°äº†ä¸‰å¤§æŠ€æœ¯:

### `Namespaces`(å‘½åç©ºé—´)

**å‘½åç©ºé—´ (namespaces) æ˜¯ Linux ä¸ºæˆ‘ä»¬æä¾›çš„ç”¨äºåˆ†ç¦»è¿›ç¨‹æ ‘ã€ç½‘ç»œæ¥å£ã€æŒ‚è½½ç‚¹ä»¥åŠè¿›ç¨‹é—´é€šä¿¡ç­‰èµ„æºçš„æ–¹æ³•.**

#### è¿›ç¨‹éš”ç¦»

åœ¨`Docker Deamon`å¯åŠ¨çš„åˆæœŸï¼Œä¼šé€šè¿‡`setNamespaces`å‡½æ•°å»åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´.åœ¨åˆ›å»ºå‘½åç©ºé—´ä½¿ç”¨çš„`clone`å‡½æ•°ä¸­ä¼ å…¥`CLONE_NEWPID`å‚æ•°å°±å®Œæˆå®¹å™¨å¯¹å®¿ä¸»æœºä¹‹é—´çš„è¿›ç¨‹éš”ç¦».

![image.png](http://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19f1fa31d914462babe10c652cfb42df~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

#### æ–‡ä»¶èµ„æºéš”ç¦»

åœ¨åˆ›å»ºå‘½åç©ºé—´ä½¿ç”¨çš„`clone`å‡½æ•°ä¸­ä¼ å…¥`CLONE_NEWNS`å‚æ•°ï¼Œå­è¿›ç¨‹å³å¯å¾—åˆ°çˆ¶è¿›ç¨‹æŒ‚è½½çš„æ‹·è´.

å½“å®¹å™¨åˆ›å»ºæ—¶ï¼Œå®¹å™¨éœ€è¦ä¸€ä¸ªè‡ªå·±çš„rootfsæ¥å®ç°ä¸åˆ«çš„å®¹å™¨æ–‡ä»¶èµ„æºéš”ç¦»ï¼Œæ‰€ä»¥å½“Dockeråˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šå°†å®¹å™¨éœ€è¦çš„ç›®å½•è¿›è¡ŒæŒ‚è½½ï¼Œå¹¶æ”¹å˜å®¹å™¨èƒ½è®¿é—®çš„æ ¹ç›®å½•ï¼Œå°†å®¹å™¨ä¹‹é—´çš„æ–‡ä»¶ç³»ç»Ÿéš”ç¦».

> æ”¹å˜å®¹å™¨èƒ½å¤Ÿè®¿é—®ä¸ªæ–‡ä»¶ç›®å½•çš„æ ¹èŠ‚ç‚¹ï¼Œlibcontaine æä¾›çš„äº†`pivot_root`Â æˆ–è€…Â `chroot`Â å‡½æ•°ã€‚

#### ç½‘ç»œéš”ç¦»

å½“ Docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª docker0 è™šæ‹Ÿç½‘æ¡¥ï¼Œå®é™…ä¸Šæ˜¯ Linux çš„ä¸€ä¸ª bridgeï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½¯ä»¶äº¤æ¢æœºã€‚å®ƒä¼šåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚

![image.png](http://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af358f873ec44f69b322e27c6a6a3761~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

å½“åˆ›å»ºä¸€ä¸ª Docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºäº†ä¸€å¯¹veth pairæ¥å£ã€‚è¿™å¯¹æ¥å£ä¸€ç«¯åœ¨å®¹å™¨å†…ï¼Œå³æ˜¯å®¹å™¨å†…éƒ¨çš„eth0ï¼›

> veth pairæ˜¯æˆå¯¹å‡ºç°çš„ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡æ¥å£ï¼Œä¸€ç«¯è¿ç€ç½‘ç»œåè®®æ ˆï¼Œä¸€ç«¯å½¼æ­¤ç›¸è¿ï¼Œå½¼æ­¤è”é€šçš„è¿™ç«¯æ•°æ®äº’é€šã€‚

![image.png](http://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/149f27f80f5745a6966846b523b7ba50~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

å¦ä¸€ç«¯åœ¨æœ¬åœ°å¹¶è¢«æŒ‚è½½åˆ° docker0 ç½‘æ¡¥ï¼Œåç§°ä»¥ veth å¼€å¤´ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’é€šä¿¡ã€‚Dockerå°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚

### `Control Groups`(æ§åˆ¶ç»„)

**Control Groupsï¼ˆç®€ç§° CGroupsï¼‰èƒ½å¤Ÿéš”ç¦»å®¿ä¸»æœºå™¨ä¸Šçš„ç‰©ç†èµ„æºï¼ŒCGroupæä¾›ä»¥ä¸‹è¿™äº›åŠŸèƒ½.**

-   é™åˆ¶è¿›ç¨‹ç»„å¯ä»¥ä½¿ç”¨çš„èµ„æºæ•°é‡ï¼ˆResource limiting ï¼‰ã€‚æ¯”å¦‚ï¼šmemoryå­ç³»ç»Ÿå¯ä»¥ä¸ºè¿›ç¨‹ç»„è®¾å®šä¸€ä¸ªmemoryä½¿ç”¨ä¸Šé™ï¼Œä¸€æ—¦è¿›ç¨‹ç»„ä½¿ç”¨çš„å†…å­˜è¾¾åˆ°é™é¢å†ç”³è¯·å†…å­˜ï¼Œå°±ä¼šè§¦å‘OOMï¼ˆout of memoryï¼‰ã€‚
    
-   è¿›ç¨‹ç»„çš„ä¼˜å…ˆçº§æ§åˆ¶ï¼ˆPrioritization ï¼‰ã€‚æ¯”å¦‚ï¼šå¯ä»¥ä½¿ç”¨cpuå­ç³»ç»Ÿä¸ºæŸä¸ªè¿›ç¨‹ç»„åˆ†é…ç‰¹å®šcpu shareã€‚
    
-   è®°å½•è¿›ç¨‹ç»„ä½¿ç”¨çš„èµ„æºæ•°é‡ï¼ˆAccounting ï¼‰ã€‚æ¯”å¦‚ï¼šå¯ä»¥ä½¿ç”¨cpuacctå­ç³»ç»Ÿè®°å½•æŸä¸ªè¿›ç¨‹ç»„ä½¿ç”¨çš„cpuæ—¶é—´
    
-   è¿›ç¨‹ç»„éš”ç¦»ï¼ˆIsolationï¼‰ã€‚æ¯”å¦‚ï¼šä½¿ç”¨nså­ç³»ç»Ÿå¯ä»¥ä½¿ä¸åŒçš„è¿›ç¨‹ç»„ä½¿ç”¨ä¸åŒçš„[namespace](https://link.juejin.cn/?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2Fnamespace "https://baike.baidu.com/item/namespace")ï¼Œä»¥è¾¾åˆ°éš”ç¦»çš„ç›®çš„ï¼Œä¸åŒçš„è¿›ç¨‹ç»„æœ‰å„è‡ªçš„è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç©ºé—´ã€‚
    
-   è¿›ç¨‹ç»„æ§åˆ¶ï¼ˆControlï¼‰ã€‚æ¯”å¦‚ï¼šä½¿ç”¨[freezer](https://link.juejin.cn/?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2Ffreezer "https://baike.baidu.com/item/freezer")å­ç³»ç»Ÿå¯ä»¥å°†è¿›ç¨‹ç»„æŒ‚èµ·å’Œæ¢å¤
    

#### ç‰©ç†èµ„æºéš”ç¦»

**CGroupé€šè¿‡å¤šä¸ªå­ç³»ç»Ÿæ¥æ§åˆ¶ç³»ç»Ÿèµ„æºçš„åˆ†é….**

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`lssubsys -m`æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸‹CGroupå¯¹åº”çš„å­ç³»ç»Ÿç›®å½•.

-   `cpuset` `/sys/fs/cgroup/cpuset`
-   `cpuï¼Œcpuacct` `/sys/fs/cgroup/cpuï¼Œcpuacct`
-   `blkio` `/sys/fs/cgroup/blkio`
-   `memory` `/sys/fs/cgroup/memory`
-   `devices` `/sys/fs/cgroup/devices`
-   `freezer` `/sys/fs/cgroup/freezer`
-   `net_clsï¼Œnet_prio` `/sys/fs/cgroup/net_clsï¼Œnet_prio`
-   `perf_event` `/sys/fs/cgroup/perf_event`
-   `pids` `/sys/fs/cgroup/pids`

åœ¨å®¿ä¸»æœºå†…ï¼Œé¦–å…ˆå½“Dockerå¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸Šè¿°çš„æ‰€æœ‰å­ç³»ç»Ÿä¸‹åˆ›å»ºdockeræ–‡ä»¶å¤¹.

å½“Dockeråˆ›å»ºå®¹å™¨æ—¶ï¼Œä¼šåœ¨dockeræ–‡ä»¶å¤¹ä¸‹çš„taskå­ç›®å½•ä¸‹åˆ›å»ºpidå¯¹åº”çš„æ–°æ–‡ä»¶å¯¹å®¹å™¨èµ„æºè¿›è¡Œåˆ†é…ä»¥åŠç®¡æ§.

![image.png](http://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1738b491e1542ed8714637df711e7e2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

### `UnionFS`(è”åˆæ–‡ä»¶ç³»ç»Ÿ)

**Unionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹**

![2017-11-30-docker-filesystems.png](http://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ce9911333b744a1a56f289579e911cb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

åœ¨Dockerä¸­ï¼Œæ¯ä¸€ä¸ªé•œåƒå±‚éƒ½æ˜¯å»ºç«‹åœ¨å¦ä¸€ä¸ªé•œåƒå±‚ä¹‹ä¸Šçš„ï¼ŒåŒæ—¶æ‰€æœ‰çš„é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œåªæœ‰æ¯ä¸ªå®¹å™¨æœ€é¡¶å±‚çš„å®¹å™¨å±‚æ‰å¯ä»¥è¢«ç”¨æˆ·ç›´æ¥è¯»å†™ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå¯¹æ‰€æœ‰çš„æ–‡ä»¶è¿›è¡Œç®¡ç†.

#### é•œåƒç®¡ç†

åœ¨Dockerä¸­ç›®å‰ä½¿ç”¨äº†å¤šç§æ–‡ä»¶ç³»ç»Ÿå¯¹é•œåƒè¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬å½“å‰ä¸»æµçš„`overlay2`ï¼Œ`aufs`ç­‰ç­‰.

ä¸åŒçš„å­˜å‚¨é©±åŠ¨åœ¨å­˜å‚¨é•œåƒå’Œå®¹å™¨æ–‡ä»¶æ—¶ä¹Ÿæœ‰ç€å®Œå…¨ä¸åŒçš„å®ç°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥åœ¨ Docker çš„å®˜æ–¹æ–‡æ¡£[Docker storage drivers](https://link.juejin.cn/?target=https%3A%2F%2Fdocs.docker.com%2Fstorage%2Fstoragedriver%2Fselect-storage-driver%2F "https://docs.docker.com/storage/storagedriver/select-storage-driver/")Â ä¸­æ‰¾åˆ°ç›¸åº”çš„å†…å®¹ã€‚

## Docker å¸¸ç”¨å‘½ä»¤

ğŸ³ [Docker æ¦‚å¿µï¼Œå·¥ä½œæµå’Œå®è·µ - å…¥é—¨å¿…æ‡‚](https://www.bilibili.com/video/BV1MR4y1Q738/?spm_id_from=333.999.0.0&vd_source=187e83a375c910488a1ad25cc2465299)

- `Dockerfile`ï½œ`.dockerignore`
- `docker build .`
- `docker images`
- `docker tag <IMAGE_ID> <USER_NAEM/IMAGE_NAME>:<TAG>`ï¼Œæ¯”å¦‚ `docker tag e6f dansoncutnodejs:v1.0`
- `docker login`
- `docker push <USER_NAEM/IMAGE_NAME>:<TAG>`
- `docker build -t eggpain-image .`ï¼šæ„å»ºçš„æ—¶å€™å°±æŒ‡å®šé•œåƒå
- `docker rmi -f dansoncut/nodejs:v1.0`ï¼šåé¢é‚£ä¸²å…¶å®å°±æ˜¯é•œåƒå
- `docker run -d <IMAGE_NAME>`ï¼š-d æ˜¯ detached-mode è®©å®¹å™¨ä¸å ç”¨å½“å‰çš„å‘½ä»¤è¡Œçª—å£
- `docker run -d -p <HOST_PORT:CONTAINER_PORT> --name <CONTAINER_NAME> <IMAGE_NAME>`
- `docker ps`ã€`docker ps -a`
- `docker stop <CONTAINER_NAME>`
- `docker rm -f <CONTAINER_ID>/<CONTAINER_NAME>`
- `docker exec -it <CONTAINER_NAME> /bin/bash`ï¼šä»¥ç»ˆç«¯äº¤äº’çš„æ–¹å¼è¿›å…¥å®¹å™¨

![image-20240422195743085](https://cdn.jsdelivr.net/gh/Wu-yikun/OSS/PicGo/202504132304030.png)

## Docker ç½‘ç»œæ¨¡å¼

ğŸ³ [Docker ç½‘ç»œæ¨¡å¼ Linux](https://www.bilibili.com/video/BV1Aj411r71b/?spm_id_from=333.999.0.0&vd_source=187e83a375c910488a1ad25cc2465299)ã€Bridge | Host | Noneã€‘

- `sudo docker network ls`
    - Bridgeï¼š**å¦‚æœæ²¡æœ‰æŒ‡å®šå®¹å™¨çš„ç½‘ç»œï¼Œé»˜è®¤åŠ å…¥çš„éƒ½æ˜¯ã€Œé»˜è®¤ Bridgeã€ç½‘ç»œ**ï¼Œè‡ªå®šä¹‰ Bridge ç½‘ç»œå¯ä»¥æä¾›è‡ªåŠ¨ DNS è§£æï¼ˆé»˜è®¤ Bridge ä¸ä¼šè‡ªåŠ¨ä¸ºå®¹å™¨é—´è¿›è¡Œ DNS è§£æï¼‰ï¼Œä¸åŒ Bridge ç½‘ç»œè¿˜å¯ä»¥å®ç°æ›´å¥½çš„éš”ç¦»ï¼Œæ‰€ä»¥éå¸¸é€‚åˆå•ä¸ªå®¿ä¸»é‡Œè¿è¡Œå¤šä¸ªå®¹å™¨ã€‚çœŸå› ä¸ºèµ·åˆ°éš”ç¦»ä½œç”¨ï¼Œå®¹å™¨é‡Œçš„æ•°æ®è¦å‡ºæ¥éœ€è¦åœ°å€è½¬åŒ–ï¼Œå³ NATï¼Œæ€§èƒ½ä¼šè¢«æ‹‰ä½ã€‚
    - Hostï¼šHost ç½‘ç»œå°±ä¸éœ€è¦åœ°å€è½¬æ¢äº†ï¼Œå³ä¸éœ€è¦ç«¯å£æ˜ å°„ï¼ˆç›´æ¥æŒ‡å®š `--network host`ï¼‰ï¼Œå› ä¸ºå®¹å™¨ç›´æ¥å’Œå®¿ä¸»åˆä½“äº†ï¼Œé€‚åˆé«˜ç½‘ç»œæ€§èƒ½çš„åœºæ™¯ï¼Œä½†å­˜åœ¨å®‰å…¨é—®é¢˜ï¼›Host ç½‘ç»œæ²¡æœ‰è‡ªå·±çš„ IP åœ°å€ï¼Œ**åœ¨å•ä¸ªå®¹å™¨éœ€è¦å¤„ç†å¤§é‡ç«¯å£çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦åƒ Bridge ç½‘ç»œé‚£æ ·é€ä¸ªç«¯å£è¿›è¡Œå…³è”**ï¼Œä½†æ˜¯å¦‚æœè¦å¤šä¸ªå®¹å™¨ç”¨åŒä¸€ä¸ªç«¯å£ä¼šå‡ºç°ç«¯å£å†²çªï¼ˆè¯¥æ¨¡å¼ä»…èƒ½åœ¨ Linux ä¸»æœºä¸Šå®ç°ï¼‰
    - Noneï¼šä¸èƒ½è”ç½‘ï¼Œé€‚åˆè¿›è¡Œå¤‡ä»½ï¼Œæœ‰äº›éœ€è¦ç½‘ç»œéš”ç¦»çš„ä¸€æ¬¡æ€§æ“ä½œä¹Ÿéå¸¸å¥½ç”¨ã€‚
- `sudo docker network create -d bridge <BRIDGE_NAME>`ï¼šè‡ªå®šä¹‰ Bridge ç½‘ç»œï¼Œåˆ›å»ºçš„ç½‘ç»œå¯ä»¥é€šè¿‡ `sudo docker network ls` æŸ¥çœ‹ï¼›é»˜è®¤ Bridge ç½‘ç»œèŒƒå›´æ˜¯ `172.17.0.0/16`ï¼Œç½‘å…³æ˜¯ `172.17.0.1`ï¼›è€Œæ–°åˆ›å»ºçš„ç½‘ç»œåˆ™æ˜¯ `172.18.0.0/16`ï¼Œç½‘å…³ä¸º `172.18.0.1`ã€‚æ­¤åä¼šå‡ºç°ä¸€ä¸ªç±»ä¼¼ `docker0` çš„æ¥å£ã€‚
- Docker å®‰è£…åä¼šå‡ºç°ä¸€ä¸ª `docker 0` çš„ç«¯å£
- `sudo docker run -d --name naihe1 --hostname naihe1 --network naihe-bridge <IMAGE>`ï¼š**åˆ›å»ºä¸€ä¸ªå®¹å™¨åŠ å…¥åˆ°è‡ªå®šä¹‰çš„ Bridge ç½‘ç»œ**
- `sudo docker run -d --name egg --network host <IMAGE>`ï¼š**åˆ›å»ºä¸€ä¸ª Host ç½‘ç»œä¸‹çš„å®¹å™¨**ï¼Œæ­¤æ—¶å°±ä¸éœ€è¦ç«¯å£å…³è”äº†ï¼Œå› ä¸ºè¯¥å®¹å™¨å’Œå®¿ä¸»å…±ç”¨æ‰€æœ‰ç½‘ç»œå’Œç«¯å£
- `sudo docker run -it --network none <IMAGE>`ï¼š**none ç½‘ç»œï¼Œæ— æ³•è”ç½‘**
- `sudo docker network rm <NETWORK_NAME>`ï¼šåˆ é™¤ç½‘ç»œï¼ˆBridge ç½‘ç»œå¯ä»¥æœ‰å¤šä¸ªï¼ŒHost ç½‘ç»œåªèƒ½æœ‰ä¸€ä¸ªï¼‰ï¼Œæ³¨æ„ï¼Œé»˜è®¤ bridgeã€hostã€none ç½‘ç»œéƒ½ä¸èƒ½åˆ é™¤ï¼›è¯¥å‘½ä»¤ä»…é’ˆå¯¹è‡ªå®šä¹‰ Bridge ç½‘ç»œã€‚

![image-20240422203844488](https://cdn.jsdelivr.net/gh/Wu-yikun/OSS/PicGo/202404222109674.png)

![image-20240422204313870](https://cdn.jsdelivr.net/gh/Wu-yikun/OSS/PicGo/202504132305798.png)

## dockerfile ä¸ docker-compose é€šä¿—è§£é‡Š

å…ˆç®€å•ç†è§£ docker çš„ä½¿ç”¨è¿‡ç¨‹ï¼Œå®ƒåˆ†ä¸º**é•œåƒæ„å»º**ä¸**å®¹å™¨å¯åŠ¨**ã€‚

- é•œåƒæ„å»ºï¼šå³åˆ›å»ºä¸€ä¸ªé•œåƒï¼Œå®ƒåŒ…å«å®‰è£…è¿è¡Œæ‰€éœ€çš„ç¯å¢ƒã€ç¨‹åºä»£ç ç­‰ã€‚è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹å°±æ˜¯ä½¿ç”¨ *dockerfile* æ¥å®Œæˆçš„ã€‚
- å®¹å™¨å¯åŠ¨ï¼šå®¹å™¨æœ€ç»ˆè¿è¡Œèµ·æ¥æ˜¯é€šè¿‡æ‹‰å–æ„å»ºå¥½çš„é•œåƒï¼Œé€šè¿‡ä¸€ç³»åˆ—è¿è¡ŒæŒ‡ä»¤ï¼ˆå¦‚ç«¯å£æ˜ å°„ã€å¤–éƒ¨æ•°æ®æŒ‚è½½ã€ç¯å¢ƒå˜é‡ç­‰ï¼‰æ¥å¯åŠ¨æœåŠ¡çš„ã€‚é’ˆå¯¹å•ä¸ªå®¹å™¨ï¼Œè¿™å¯ä»¥é€šè¿‡ `docker run` æ¥è¿è¡Œã€‚

è€Œå¦‚æœæ¶‰åŠå¤šä¸ªå®¹å™¨çš„è¿è¡Œï¼ˆå¦‚æœåŠ¡ç¼–æ’ï¼‰å°±å¯ä»¥é€šè¿‡ `docker-compose` æ¥å®ç°ï¼Œå®ƒå¯ä»¥è½»æ¾çš„å°†å¤šä¸ªå®¹å™¨ä½œä¸º service æ¥è¿è¡Œï¼ˆå½“ç„¶ä¹Ÿå¯ä»…è¿è¡Œå…¶ä¸­çš„æŸä¸ªï¼‰ï¼Œå¹¶ä¸”æä¾›äº† scale (æœåŠ¡æ‰©å®¹) çš„åŠŸèƒ½ã€‚

ğŸ™„ç®€å•æ€»ç»“ï¼š

1. dockerfile: æ„å»ºé•œåƒï¼›
2. docker run: å¯åŠ¨å®¹å™¨ï¼›
3. docker-compose: å¯åŠ¨æœåŠ¡ï¼›

> ä»å¤´å¼€å§‹ï¼šdockerfileã€docker runã€docker-compose å­˜åœ¨çš„å¿…è¦æ€§

å‡å¦‚ä½ ä¸ç”¨ docker ï¼Œæ­å»º wordpress æ€ä¹ˆå¼„ï¼Ÿå…ˆæ‰¾å° server ï¼Œå‡è®¾å…¶ OS ä¸º Ubuntu ï¼Œç„¶åæŒ‰ç…§æ–‡æ¡£ä¸€æ­¥æ­¥æ•²å‘½ä»¤ï¼Œå†™é…ç½®ï¼Œå¯¹å§ï¼Ÿ

ç”¨ docker å‘¢ï¼Ÿ éšä¾¿æ‰¾å° server ï¼Œä¸ç®¡ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œåªè¦æ”¯æŒ docker å°±è¡Œï¼Œ `docker run ubuntu`, docker ä¼šä»å®˜æ–¹æºé‡Œæ‹‰å–æœ€æ–°çš„ Ubuntu é•œåƒï¼Œå¯ä»¥è®¤ä¸ºä½ å¼€äº†ä¸ª Ubuntu è™šæ‹Ÿæœºï¼Œç„¶åä¸€æ­¥æ­¥å®‰è£…ï¼Œè·Ÿä¸Šé¢ä¸€æ ·ã€‚

ä½†æ˜¯è¿™æ ·å®‰è£…æœ‰ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ï¼Œä¸€æ—¦ container è¢«åˆ ï¼Œä½ åšçš„å·¥ä½œå°±éƒ½æ²¡äº†ã€‚å½“ç„¶å¯ä»¥ç”¨ `docker commit` æ¥ä¿å­˜æˆé•œåƒï¼Œè¿™æ ·å°±å¯ä»¥å¤ç”¨äº†ã€‚

ä½†æ˜¯é•œåƒä¸€èˆ¬æ¯”è¾ƒå¤§ï¼Œè€Œä¸”åªåˆ†äº«é•œåƒçš„è¯ï¼Œåˆ«äººä¹Ÿä¸çŸ¥é“ä½ è¿™é•œåƒåˆ°åº•åŒ…å«ä»€ä¹ˆï¼Œè¿™äº›é—®é¢˜éƒ½ä¸åˆ©äºåˆ†äº«å’Œå¤ç”¨ã€‚

ä¸€ä¸ªç›´è§‚çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œå†™ä¸ªè„šæœ¬æŠŠå®‰è£…è¿‡ç¨‹å…¨éƒ¨è®°å½•ä¸‹æ¥ï¼Œè¿™æ ·å†æ¬¡å®‰è£…çš„æ—¶å€™ï¼Œæ‰§è¡Œè„šæœ¬å°±è¡Œäº†ã€‚ Dockerfile å°±æ˜¯è¿™æ ·çš„è„šæœ¬ï¼Œå®ƒè®°å½•äº†ä¸€ä¸ªé•œåƒçš„åˆ¶ä½œè¿‡ç¨‹ã€‚

æœ‰äº† Dockerfile, åªè¦æ‰§è¡Œ `docker build .` å°±èƒ½åˆ¶ä½œé•œåƒï¼Œè€Œä¸” Dockerfile å°±æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œä¿®æ”¹ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚

ç°åœ¨æœ‰äº† wordpress çš„é•œåƒï¼Œåªéœ€è¦ `docker run` å°±æŠŠ wordpress å¯åŠ¨èµ·æ¥äº†ã€‚

å¦‚æœä»…ä»…æ˜¯ wordpress è¿™ä¹Ÿå°±å¤Ÿäº†ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œéœ€è¦å¤šä¸ªé•œåƒåˆä½œæ‰èƒ½å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚å‰ç«¯è¦æœ‰ nginx ï¼Œ æ•°æ®åº“ mysql, é‚®ä»¶æœåŠ¡ç­‰ç­‰ï¼Œå½“ç„¶ä½ å¯ä»¥æŠŠæ‰€æœ‰è¿™äº›éƒ½å¼„åˆ°ä¸€ä¸ªé•œåƒé‡Œå»ï¼Œä½†è¿™æ ·åšå°±æ— æ³•å¤ç”¨äº†ã€‚

æ›´å¸¸è§çš„æ˜¯ï¼Œnginx, mysql, smtp éƒ½åˆ†åˆ«æ˜¯ä¸ªé•œåƒï¼Œç„¶åè¿™äº›é•œåƒåˆä½œï¼Œå…±åŒæœåŠ¡ä¸€ä¸ªé¡¹ç›®ã€‚

`docker-compose` å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚ä½ çš„é¡¹ç›®éœ€è¦å“ªäº›é•œåƒï¼Œæ¯ä¸ªé•œåƒæ€ä¹ˆé…ç½®ï¼Œè¦æŒ‚è½½å“ªäº› `volume`, ç­‰ç­‰ä¿¡æ¯éƒ½åŒ…å«åœ¨ *docker-compose.yml* é‡Œã€‚

è¦å¯åŠ¨æœåŠ¡ï¼Œåªéœ€è¦ `docker-compose up` å°±è¡Œï¼Œåœæ­¢ä¹Ÿåªéœ€è¦ `docker-compse stop/down`

ç®€è€Œè¨€ä¹‹ï¼Œ Dockerfile è®°å½•å•ä¸ªé•œåƒçš„æ„å»ºè¿‡ç¨‹ï¼Œ docker-compse.yml è®°å½•ä¸€ä¸ªé¡¹ç›®ï¼ˆproject, ä¸€èˆ¬æ˜¯å¤šä¸ªé•œåƒï¼‰çš„æ„å»ºè¿‡ç¨‹ã€‚

ä½ è¯´æœ‰äº›æ•™ç¨‹ç”¨äº† ***dockerfile*** + ***docker-compose***, æ˜¯å› ä¸º ***docker-compose.yml*** æœ¬èº«æ²¡æœ‰é•œåƒæ„å»ºçš„ä¿¡æ¯ï¼Œå¦‚æœé•œåƒæ˜¯ä» *docker registry* æ‹‰å–ä¸‹æ¥çš„ï¼Œé‚£ä¹ˆ Dockerfile å°±ä¸éœ€è¦ï¼›å¦‚æœé•œåƒæ˜¯éœ€è¦ build çš„ï¼Œé‚£å°±éœ€è¦æä¾› Dockerfile.

docker-composeæ˜¯ç¼–æ’å®¹å™¨çš„ã€‚ä¾‹å¦‚ï¼Œä½ æœ‰ä¸€ä¸ª php é•œåƒï¼Œä¸€ä¸ª mysql é•œåƒï¼Œä¸€ä¸ª nginx é•œåƒã€‚å¦‚æœæ²¡æœ‰ docker-composeï¼Œé‚£ä¹ˆæ¯æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œä½ éœ€è¦æ•²å„ä¸ªå®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼Œç¯å¢ƒå˜é‡ï¼Œå®¹å™¨å‘½åï¼ŒæŒ‡å®šä¸åŒå®¹å™¨çš„é“¾æ¥å‚æ•°ç­‰ç­‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œç›¸å½“ç¹çã€‚è€Œç”¨äº† docker-composer ä¹‹åï¼Œä½ å°±å¯ä»¥æŠŠè¿™äº›å‘½ä»¤ä¸€æ¬¡æ€§å†™åœ¨ *docker-composer.yml* æ–‡ä»¶ä¸­ï¼Œä»¥åæ¯æ¬¡å¯åŠ¨è¿™ä¸€æ•´ä¸ªç¯å¢ƒï¼ˆå« 3 ä¸ªå®¹å™¨ï¼‰çš„æ—¶å€™ï¼Œä½ åªè¦æ•²ä¸€ä¸ª `docker-composer up` å‘½ä»¤å°±okäº†ã€‚

dockerfile çš„ä½œç”¨æ˜¯ä»æ— åˆ°æœ‰çš„æ„å»ºé•œåƒã€‚å®ƒåŒ…å«å®‰è£…è¿è¡Œæ‰€éœ€çš„ç¯å¢ƒã€ç¨‹åºä»£ç ç­‰ã€‚è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹å°±æ˜¯ä½¿ç”¨ dockerfile æ¥å®Œæˆçš„ã€‚

**Dockerfile**ï¼šä¸º `docker build` å‘½ä»¤å‡†å¤‡çš„ï¼Œç”¨äºå»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„ image ï¼Œåœ¨ docker-compose é‡Œä¹Ÿå¯ä»¥ç”¨æ¥å®æ—¶ buildã€‚

**docker-compose.yml**ï¼šä¸º `docker-compose` å‡†å¤‡çš„è„šæœ¬ï¼Œå¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ª container ï¼ŒåŒ…æ‹¬ä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€ç”¨å®˜æ–¹ image è¿˜æ˜¯è‡ªå·± build ã€å„ç§ç½‘ç»œç«¯å£å®šä¹‰ã€å‚¨å­˜ç©ºé—´å®šä¹‰ç­‰ã€‚

## æ€»ç»“

çœ‹åˆ°è¿™é‡Œç›¸ä¿¡å„ä½è¯»è€…æœ‹å‹ä»¬å¯¹ Docker å·²ç»æœ‰äº†æ›´ä¸ºæ·±åˆ»çš„ç†è§£.

ç”±äº Docker æ›´æ–°è‡³ä»Šï¼Œä»£ç åº“å¤ªè¿‡åºå¤§ï¼Œä¹Ÿåªèƒ½ä»ä½ç‰ˆæœ¬çš„ Docker æºç ä»¥åŠå¤§ä½¬ä»¬çš„ Docker æŠ€æœ¯æ–‡ç« ä¸­çª¥å…¶ä¸€äºŒï¼Œå¦‚æœæœ‰æ„Ÿå…´è¶£çš„æœ‹å‹ä¹Ÿå¯ä»¥ç›¸äº’äº¤æµ.

## å‚è€ƒæ–‡çŒ®

-   ã€ŠDockeræºç åˆ†æã€‹(å­™å®äº®)
-   [Docker æ ¸å¿ƒæŠ€æœ¯ä¸å®ç°åŸç† - é¢å‘ä¿¡ä»°ç¼–ç¨‹](https://link.juejin.cn/?target=https%3A%2F%2Fdraveness.me%2Fdocker%2F "https://draveness.me/docker/")
-   [dockerå®¹å™¨æŠ€æœ¯ä»‹ç»](https://link.juejin.cn/?target=https%3A%2F%2Ftech.bytedance.net%2Farticles%2F6872293753253134344%23heading1 "https://tech.bytedance.net/articles/6872293753253134344#heading1")
-   [DockeråŸºç¡€é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿéƒ½æœ‰å“ªäº›ï¼Ÿ](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43413788%2Farticle%2Fdetails%2F108162920 "https://blog.csdn.net/qq_43413788/article/details/108162920")
-   [è™šæ‹ŸåŒ–æŠ€æœ¯ä»‹ç» & hypervisorç®€ä»‹](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fusstmiracle%2Farticle%2Fdetails%2F111178532 "https://blog.csdn.net/usstmiracle/article/details/111178532")
-   [dockerå®¹å™¨æŠ€æœ¯ä»‹ç»](https://link.juejin.cn/?target=https%3A%2F%2Ftech.bytedance.net%2Farticles%2F6872293753253134344%23heading1 "https://tech.bytedance.net/articles/6872293753253134344#heading1")
-   [è¿™å¯èƒ½æ˜¯æœ€ä¸ºè¯¦ç»†çš„Dockerå…¥é—¨åè¡€æ€»ç»“](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fdeng624796905%2Farticle%2Fdetails%2F86493330%3Fops_request_misc%3D%25257B%252522request%25255Fid%252522%25253A%252522166107576616782246456566%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D%26request_id%3D166107576616782246456566%26biz_id%3D0%26utm_medium%3Ddistribute.pc_search_result.none-task-blog-2~blog~top_positive~default-2-86493330-null-null.nonecase%26utm_term%3Ddocker%26spm%3D1018.2226.3001.4450 "https://blog.csdn.net/deng624796905/article/details/86493330?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166107576616782246456566%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166107576616782246456566&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~top_positive~default-2-86493330-null-null.nonecase&utm_term=docker&spm=1018.2226.3001.4450")
-   [Dockeræ¶æ„ç®€ä»‹](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fcbmljs%2Farticle%2Fdetails%2F123353108 "https://blog.csdn.net/cbmljs/article/details/123353108")
-   [VM VS Container æµ…è°ˆHpervisorè™šæ‹ŸåŒ–æŠ€æœ¯å’Œå®¹å™¨æŠ€æœ¯](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fqq_33934427%2Farticle%2Fdetails%2F120487243%3Fspm%3D1001.2101.3001.6650.1%26utm_medium%3Ddistribute.pc_relevant.none-task-blog-2%257Edefault%257ECTRLIST%257ERate-1-120487243-blog-111178532.pc_relevant_default%26depth_1-utm_source%3Ddistribute.pc_relevant.none-task-blog-2%257Edefault%257ECTRLIST%257ERate-1-120487243-blog-111178532.pc_relevant_default%26utm_relevant_index%3D2 "https://blog.csdn.net/qq_33934427/article/details/120487243?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-120487243-blog-111178532.pc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-120487243-blog-111178532.pc_relevant_default&utm_relevant_index=2")
-   [Dockerå¸¸ç”¨å‘½ä»¤åŸç†å›¾](https://link.juejin.cn/?target=https%3A%2F%2Fwww.huweihuang.com%2Farticle%2Fdocker%2Fdocker-commands-principle%2F "https://www.huweihuang.com/article/docker/docker-commands-principle/")
-   [Linuxé•œåƒrunèµ·æ¥ï¼Œå…­ã€Docker run è¿è¡Œé•œåƒ](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_35470511%2Farticle%2Fdetails%2F116889363 "https://blog.csdn.net/weixin_35470511/article/details/116889363")
